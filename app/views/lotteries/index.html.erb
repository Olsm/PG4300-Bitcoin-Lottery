

<%=render 'lotteries/modal'%>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h1 class="text-center">
        Lotteries
      </h1>
    </div>
    <div id="no-more-tables">
      <table class="col-md-12 table-bordered table-striped table-condensed cf" style = "word-wrap:break-word;">
        <thead class="cf">
        <tr>
          <th>Id</th>
          <th>Status</th>
          <th>Prize</th>
          <th>Address</th>
          <th>QR-code</th>
          <th>Ends</th>
          <th>Winner</th>
          <th colspan="7"></th>
        </tr>
        </thead>
        <tbody>
        <% @lotteries.each do |l| %>
            <tr>
              <td data-title = "ID"><%= l.id %></td>
              <td data-title = "Status"><%= l.status %></td>
              <td data-title = "Prize"><%= l.prize_amount %></td>
              <td data-title = "Address"><%= l.bitcoin_address %></td>
              <td data-title = "QR-code" class="qrcode"><img src=<%=l.qr_code%>></td>
              <td data-title = "Ends"><%= l.ends_at %></td>
              <td data-title = "Winner" ><%= link_to l.winner_entry, lottery_entry_path(l.winner_entry) if l.winner_entry %></td>
              <td><button type="button" class="btn btn-info" data-dismiss="modal" data-target="#myModal" data-toggle="modal"  data-lottery-id=<%= l.id%> data-lottery-status=<%= l.status%> data-lottery-qr=<%= l.qr_code%>
                  data-lottery-prize=<%= l.prize_amount%> data-lottery-address=<%= l.bitcoin_address%> data-lottery-ends=<%= l.ends_at%>
                          data-lottery-winner-link=<%=lottery_entry_path(l.winner_entry) unless l.winner_entry.blank?%>
                              data-lottery-winner=<%=l.winner_entry unless l.winner_entry.blank?%> >View lottery</button></td>
            </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>









<script type="text/javascript">
  $('#myModal').on('show.bs.modal', function (e) {
    var myId = $(e.relatedTarget).data('lottery-id');
    document.getElementById("lotteryId").innerHTML = "Lottery#" + myId.toString();
    var myStatus = $(e.relatedTarget).data('lottery-status');
    document.getElementById("lotteryStatus").innerHTML = myStatus.toString();
    var myQR = $(e.relatedTarget).data('lottery-qr');
    document.getElementById("lotteryqr").src = myQR.toString();
    var myPrize = $(e.relatedTarget).data('lottery-prize');
    document.getElementById("lotteryPrize").innerHTML = myPrize.toString();
    var myAddress = $(e.relatedTarget).data('lottery-address');
    document.getElementById("lotteryAddress").innerHTML = myAddress.toString();
    var myEndTime = $(e.relatedTarget).data('lottery-ends');
    document.getElementById("lotteryEnds").innerHTML = myEndTime.toString();
    var myWinner = $(e.relatedTarget).data('lottery-winner');
    var myWinnerLink = $(e.relatedTarget).data('lottery-winner-link');
    if(myWinner && myWinnerLink){
      document.getElementById("lotteryWinnerLink").innerHTML = myWinner.toString();
      document.getElementById("lotteryWinnerLink").href = myWinnerLink.toString();
    }
    else{
      document.getElementById("lotteryWinnerLink").innerHTML = "";
      document.getElementById("lotteryWinnerLink").href = "";
    }
  });



</script>
